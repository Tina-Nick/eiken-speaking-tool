<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>英検 準2級・3級 Q&A 練習</title>
  <style>
    body { font-family: sans-serif; padding: 20px; }
    button { margin: 5px; padding: 10px 15px; font-size: 16px; }
    .card { border: 1px solid #ccc; border-radius: 8px; padding: 15px; margin-top: 20px; }
    .answer, .translation { margin-top: 10px; display: none; }
    select { font-size: 16px; padding: 5px; }
  </style>
</head>
<body>
  <h1>英検 準2級・3級 Q&A 練習</h1>

  <label for="gradeSelect">級を選択：</label>
  <select id="gradeSelect" onchange="resetAll()">
    <option value="grade3">3級</option>
    <option value="gradePre2">準2級</option>
  </select>

  <div>
    <button onclick="showQuestion()">お題を表示（質問①: Yes / No）</button>
    <div class="card" id="questionCard" style="display:none;">
      <h2 id="questionText"></h2>
      <p><button onclick="toggleTranslation('question')">和訳を表示</button></p>
      <p class="translation" id="questionTranslation"></p>
      <button onclick="showAnswer('yes')">Yesの答えを表示</button>
      <button onclick="showAnswer('no')">Noの答えを表示</button>
      <div class="answer" id="yesAnswer"></div>
      <p><button onclick="toggleTranslation('yes')">和訳を表示</button></p>
      <p class="translation" id="yesTranslation"></p>
      <div class="answer" id="noAnswer"></div>
      <p><button onclick="toggleTranslation('no')">和訳を表示</button></p>
      <p class="translation" id="noTranslation"></p>
    </div>
  </div>

  <div>
    <button onclick="showWhQuestion()">お題を表示（質問②: 前置きあり Yes / No）</button>
    <div class="card" id="whCard" style="display:none;">
      <h2 id="whQuestionText"></h2>
      <p><button onclick="toggleTranslation('wh')">和訳を表示</button></p>
      <p class="translation" id="whQuestionTranslation"></p>
      <button onclick="showWhAnswer('yes')">Yesの答えを表示</button>
      <button onclick="showWhAnswer('no')">Noの答えを表示</button>
      <div class="answer" id="shortAnswer"></div>
      <p><button onclick="toggleTranslation('short')">和訳を表示</button></p>
      <p class="translation" id="shortTranslation"></p>
      <div class="answer" id="longAnswer"></div>
      <p><button onclick="toggleTranslation('long')">和訳を表示</button></p>
      <p class="translation" id="longTranslation"></p>
    </div>
  </div>

  <script src="grade3.js"></script>
  <script src="grade3_wh.js"></script>
  <script src="gradePre2.js"></script>
  <script src="gradePre2_wh.js"></script>
  <script>
    let currentQA = null;
    let currentWhQA = null;

    function getSelectedGrade() {
      return document.getElementById("gradeSelect").value;
    }

    function resetAll() {
      // 問題と答えの表示リセット
      document.getElementById("questionCard").style.display = "none";
      document.getElementById("whCard").style.display = "none";

      ["yesAnswer", "noAnswer", "shortAnswer", "longAnswer",
       "questionTranslation", "yesTranslation", "noTranslation",
       "whQuestionTranslation", "shortTranslation", "longTranslation"
      ].forEach(id => {
        const el = document.getElementById(id);
        if (el) el.style.display = "none";
        if (el) el.textContent = "";
      });

      // 問題文もクリア
      document.getElementById("questionText").textContent = "";
      document.getElementById("whQuestionText").textContent = "";
    }

    function showQuestion() {
      const grade = getSelectedGrade();
      const questions = grade === "grade3" ? grade3_questions : gradePre2_questions;
      const i = Math.floor(Math.random() * questions.length);
      currentQA = questions[i];

      document.getElementById("questionText").textContent = currentQA.question;
      document.getElementById("questionTranslation").textContent = currentQA.translation || "";

      ["yesAnswer", "noAnswer", "yesTranslation", "noTranslation", "questionTranslation"].forEach(id => {
        const el = document.getElementById(id);
        if (el) el.style.display = "none";
        if (id !== "questionTranslation") el.textContent = "";
      });

      document.getElementById("questionCard").style.display = "block";
    }

    function showAnswer(type) {
      if (!currentQA) return;

      const answer = currentQA.answers[type];
      const translation = currentQA.answerTranslations[type];
      const el = document.getElementById(type + "Answer");
      const tr = document.getElementById(type + "Translation");
      el.textContent = answer;
      el.style.display = "block";
      tr.textContent = translation || "";
      tr.style.display = "none";
    }

    function showWhQuestion() {
      const grade = getSelectedGrade();
      const questions = grade === "grade3" ? grade3_wh_questions : gradePre2_wh_questions;
      const i = Math.floor(Math.random() * questions.length);
      currentWhQA = questions[i];

      document.getElementById("whQuestionText").textContent = currentWhQA.question;
      document.getElementById("whQuestionTranslation").textContent = currentWhQA.translation || "";

      ["shortAnswer", "longAnswer", "shortTranslation", "longTranslation", "whQuestionTranslation"].forEach(id => {
        const el = document.getElementById(id);
        if (el) el.style.display = "none";
        if (!id.includes("Translation")) el.textContent = "";
      });

      document.getElementById("whCard").style.display = "block";
    }

    function showWhAnswer(type) {
      if (!currentWhQA) return;

      // 準2級はyes/noの答えなので、shortAnswerとlongAnswerにそれぞれ表示
      const grade = getSelectedGrade();
      if (grade === "gradePre2") {
        const answer = currentWhQA.answers[type];
        const translation = currentWhQA.answerTranslations[type];
        if(type === "yes") {
          document.getElementById("shortAnswer").textContent = answer;
          document.getElementById("longAnswer").textContent = "";
          document.getElementById("shortTranslation").textContent = translation || "";
          document.getElementById("longTranslation").textContent = "";
          document.getElementById("shortAnswer").style.display = "block";
          document.getElementById("longAnswer").style.display = "none";
          document.getElementById("shortTranslation").style.display = "none";
          document.getElementById("longTranslation").style.display = "none";
        } else if(type === "no") {
          document.getElementById("longAnswer").textContent = answer;
          document.getElementById("shortAnswer").textContent = "";
          document.getElementById("longTranslation").textContent = translation || "";
          document.getElementById("shortTranslation").textContent = "";
          document.getElementById("longAnswer").style.display = "block";
          document.getElementById("shortAnswer").style.display = "none";
          document.getElementById("longTranslation").style.display = "none";
          document.getElementById("shortTranslation").style.display = "none";
        }
        return;
      }

      // 3級は short / long で答えが分かれている
      const answer = currentWhQA.answers[type];
      const translation = currentWhQA.translations[type];
      const el = document.getElementById(type + "Answer");
      const tr = document.getElementById(type + "Translation");
      el.textContent = answer;
      el.style.display = "block";
      tr.textContent = translation || "";
      tr.style.display = "none";
    }

    function toggleTranslation(type) {
      const trId = {
        question: "questionTranslation",
        yes: "yesTranslation",
        no: "noTranslation",
        wh: "whQuestionTranslation",
        short: "shortTranslation",
        long: "longTranslation"
      }[type];
      const el = document.getElementById(trId);
      if (!el) return;
      if (el.style.display === "none") {
        el.style.display = "block";
      } else {
        el.style.display = "none";
      }
    }
  </script>
</body>
</html>
